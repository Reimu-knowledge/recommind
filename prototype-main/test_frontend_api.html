<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端API测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .question { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>前端API测试</h1>
    
    <div class="test-section">
        <h2>测试知识点题目API</h2>
        <button onclick="testKnowledgePointAPI()">测试K3知识点</button>
        <div id="kp-result"></div>
    </div>
    
    <div class="test-section">
        <h2>测试薄弱知识点API</h2>
        <button onclick="testWeakPointsAPI()">测试薄弱知识点</button>
        <div id="weak-result"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000';
        
        async function testKnowledgePointAPI() {
            const resultDiv = document.getElementById('kp-result');
            resultDiv.innerHTML = '<p>正在测试...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/questions/by-knowledge-point/K3`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    let html = `<p class="success">✅ 成功获取 ${result.knowledge_point_name} 的题目</p>`;
                    html += `<p>题目数量: ${result.total_count}</p>`;
                    html += '<h3>题目列表:</h3>';
                    
                    result.questions.forEach((q, index) => {
                        html += `<div class="question">`;
                        html += `<strong>${index + 1}. ${q.qid}:</strong> ${q.content}<br>`;
                        html += `<strong>选项:</strong> ${q.options.join(', ')}<br>`;
                        html += `<strong>知识点权重:</strong> ${JSON.stringify(q.knowledge_points)}`;
                        html += `</div>`;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">❌ 获取失败: ${result.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ 请求异常: ${error.message}</p>`;
            }
        }
        
        async function testWeakPointsAPI() {
            const resultDiv = document.getElementById('weak-result');
            resultDiv.innerHTML = '<p>正在测试...</p>';
            
            try {
                // 先创建学生
                const createResponse = await fetch(`${API_BASE_URL}/api/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: 'test_student_frontend',
                        name: '测试学生',
                        grade: '大学'
                    })
                });
                
                if (!createResponse.ok) {
                    resultDiv.innerHTML = '<p class="error">❌ 创建学生失败</p>';
                    return;
                }
                
                // 开始学习会话
                const sessionResponse = await fetch(`${API_BASE_URL}/api/students/test_student_frontend/sessions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_name: '测试会话' })
                });
                
                if (!sessionResponse.ok) {
                    resultDiv.innerHTML = '<p class="error">❌ 开始学习会话失败</p>';
                    return;
                }
                
                // 获取薄弱知识点
                const weakResponse = await fetch(`${API_BASE_URL}/api/students/test_student_frontend/weak-points?threshold=0.3`);
                const weakResult = await weakResponse.json();
                
                if (weakResult.status === 'success') {
                    let html = `<p class="success">✅ 成功获取薄弱知识点</p>`;
                    html += `<p>薄弱知识点数量: ${weakResult.weak_knowledge_points.length}</p>`;
                    html += '<h3>薄弱知识点列表:</h3>';
                    
                    weakResult.weak_knowledge_points.forEach((kp, index) => {
                        html += `<div class="question">`;
                        html += `<strong>${index + 1}. ${kp.id}:</strong> ${kp.name}<br>`;
                        html += `<strong>掌握度:</strong> ${kp.score.toFixed(3)}`;
                        html += `</div>`;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">❌ 获取薄弱知识点失败: ${weakResult.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ 请求异常: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>

